#undef __KERNEL__
#define __KERNEL__

#undef MODULE
#define MODULE

#include <linux/module.h>    // included for all kernel modules
#include <linux/kernel.h>    // included for KERN_INFO
#include <linux/init.h>
#include <linux/kprobes.h>
#include <linux/kallsyms.h>// included for __init and __exit macros

MODULE_LICENSE("GPL");

static int __init segf_init(void)
{
	char *area =
			(char*)kallsyms_lookup_name("orch_timer"); // in orhestrator

	printk(KERN_INFO "Cleaning up segmentation fault test.\n");

	if (area==NULL)
	{
		printk("No orchestrator in the system");
        return 0;
	}

	else
	  {
		printk("Modifying orchestrator");
		memset (area, 0, 600); //triggers page fault
           }

    return 0;
}

static void __exit segf_cleanup(void)
{
    printk(KERN_INFO "Cleaning up segmentation fault test.\n");
}

module_init(segf_init);
module_exit(segf_cleanup);

